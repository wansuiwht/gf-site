"use strict";(self.webpackChunkgf_site=self.webpackChunkgf_site||[]).push([["81883"],{292780:function(n,e,o){o.r(e),o.d(e,{metadata:()=>t,contentTitle:()=>l,default:()=>p,assets:()=>s,toc:()=>d,frontMatter:()=>c});var t=JSON.parse('{"id":"\u6A21\u5757\u5217\u8868/\u6570\u636E\u7ED3\u6784/gpool -\u5BF9\u8C61\u590D\u7528\u6C60","title":"gpool (\u5BF9\u8C61\u590D\u7528\u6C60)","description":"\u5BF9\u8C61\u590D\u7528\u6C60\uFF08\u5E76\u53D1\u5B89\u5168\uFF09\u3002\u5C06\u5BF9\u8C61\u8FDB\u884C\u7F13\u5B58\u590D\u7528\uFF0C\u652F\u6301 \u8FC7\u671F\u65F6\u95F4\u3001 \u521B\u5EFA\u65B9\u6CD5 \u53CA \u9500\u6BC1\u65B9\u6CD5 \u5B9A\u4E49\u3002","source":"@site/versioned_docs/version-1.16.x/\u6A21\u5757\u5217\u8868/\u6570\u636E\u7ED3\u6784/gpool -\u5BF9\u8C61\u590D\u7528\u6C60.md","sourceDirName":"\u6A21\u5757\u5217\u8868/\u6570\u636E\u7ED3\u6784","slug":"/\u6A21\u5757\u5217\u8868/\u6570\u636E\u7ED3\u6784/gpool -\u5BF9\u8C61\u590D\u7528\u6C60","permalink":"/1.16.x/\u6A21\u5757\u5217\u8868/\u6570\u636E\u7ED3\u6784/gpool -\u5BF9\u8C61\u590D\u7528\u6C60","draft":false,"unlisted":false,"editUrl":"https://github.com/gogf/gf-site/blob/main/versioned_docs/version-1.16.x/\u6A21\u5757\u5217\u8868/\u6570\u636E\u7ED3\u6784/gpool -\u5BF9\u8C61\u590D\u7528\u6C60.md","tags":[],"version":"1.16.x","lastUpdatedBy":"John","lastUpdatedAt":1730365530000,"sidebarPosition":8,"frontMatter":{"title":"gpool (\u5BF9\u8C61\u590D\u7528\u6C60)","sidebar_position":8,"hide_title":true},"sidebar":"tutorialSidebar","previous":{"title":"gtree (\u6811\u5F62)","permalink":"/1.16.x/\u6A21\u5757\u5217\u8868/\u6570\u636E\u7ED3\u6784/gtree -\u6811\u5F62"},"next":{"title":"gring (\u5E76\u53D1\u5B89\u5168\u73AF\u7ED3\u6784)","permalink":"/1.16.x/\u6A21\u5757\u5217\u8868/\u6570\u636E\u7ED3\u6784/gring -\u5E76\u53D1\u5B89\u5168\u73AF\u7ED3\u6784"}}'),i=o("785893"),r=o("250065");let c={title:"gpool (\u5BF9\u8C61\u590D\u7528\u6C60)",sidebar_position:8,hide_title:!0},l=void 0,s={},d=[{value:"gpool\u4E0Esync.Pool",id:"gpool\u4E0Esyncpool",level:2},{value:"\u793A\u4F8B1\uFF0C\u57FA\u672C\u4F7F\u7528",id:"\u793A\u4F8B1\u57FA\u672C\u4F7F\u7528",level:2},{value:"\u793A\u4F8B2\uFF0C\u521B\u5EFA\u53CA\u9500\u6BC1\u65B9\u6CD5",id:"\u793A\u4F8B2\u521B\u5EFA\u53CA\u9500\u6BC1\u65B9\u6CD5",level:2}];function g(n){let e={a:"a",code:"code",h2:"h2",p:"p",pre:"pre",strong:"strong",...(0,r.a)(),...n.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(e.p,{children:["\u5BF9\u8C61\u590D\u7528\u6C60\uFF08\u5E76\u53D1\u5B89\u5168\uFF09\u3002\u5C06\u5BF9\u8C61\u8FDB\u884C\u7F13\u5B58\u590D\u7528\uFF0C\u652F\u6301 ",(0,i.jsx)(e.code,{children:"\u8FC7\u671F\u65F6\u95F4"}),"\u3001 ",(0,i.jsx)(e.code,{children:"\u521B\u5EFA\u65B9\u6CD5"})," \u53CA ",(0,i.jsx)(e.code,{children:"\u9500\u6BC1\u65B9\u6CD5"})," \u5B9A\u4E49\u3002"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4F7F\u7528\u573A\u666F"}),"\uFF1A"]}),"\n",(0,i.jsx)(e.p,{children:"\u4EFB\u4F55\u9700\u8981\u652F\u6301\u5B9A\u65F6\u8FC7\u671F\u7684\u5BF9\u8C61\u590D\u7528\u573A\u666F\u3002"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4F7F\u7528\u65B9\u5F0F"}),"\uFF1A"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:'import "github.com/gogf/gf/container/gpool"\n\n'})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u63A5\u53E3\u6587\u6863"}),"\uFF1A"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.a,{href:"https://godoc.org/github.com/gogf/gf/container/gpool",children:"https://godoc.org/github.com/gogf/gf/container/gpool"})}),"\n",(0,i.jsxs)(e.p,{children:["\u9700\u8981\u6CE8\u610F\u4E24\u70B9\uFF1A 1. ",(0,i.jsx)(e.code,{children:"New"})," \u65B9\u6CD5\u7684\u8FC7\u671F\u65F6\u95F4\u7C7B\u578B\u4E3A ",(0,i.jsx)(e.code,{children:"time.Duration"}),"\uFF1B 1. \u5BF9\u8C61 ",(0,i.jsx)(e.code,{children:"\u521B\u5EFA\u65B9\u6CD5"}),"( ",(0,i.jsx)(e.code,{children:"newFunc NewFunc"}),")\u8FD4\u56DE\u503C\u5305\u542B\u4E00\u4E2A ",(0,i.jsx)(e.code,{children:"error"})," \u8FD4\u56DE\uFF0C\u5F53\u5BF9\u8C61\u521B\u5EFA\u5931\u8D25\u65F6\u53EF\u7531\u8BE5\u8FD4\u56DE\u503C\u53CD\u9988\u539F\u56E0\uFF1B 1. \u5BF9\u8C61 ",(0,i.jsx)(e.code,{children:"\u9500\u6BC1\u65B9\u6CD5"}),"( ",(0,i.jsx)(e.code,{children:"expireFunc...ExpireFunc"}),")\u4E3A\u53EF\u9009\u53C2\u6570\uFF0C\u7528\u4EE5\u5F53\u5BF9\u8C61\u8D85\u65F6/\u6C60\u5173\u95ED\u65F6\uFF0C\u81EA\u52A8\u8C03\u7528\u81EA\u5B9A\u4E49\u7684\u65B9\u6CD5\u9500\u6BC1\u5BF9\u8C61\uFF1B"]}),"\n",(0,i.jsx)(e.h2,{id:"gpool\u4E0Esyncpool",children:"gpool\u4E0Esync.Pool"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.code,{children:"gpool"})," \u4E0E ",(0,i.jsx)(e.code,{children:"sync.Pool"})," \u90FD\u53EF\u4EE5\u8FBE\u5230\u5BF9\u8C61\u590D\u7528\u7684\u4F5C\u7528\uFF0C\u4F46\u662F\u4E24\u8005\u7684\u8BBE\u8BA1\u521D\u8877\u548C\u4F7F\u7528\u573A\u666F\u4E0D\u592A\u4E00\u6837\u3002"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.code,{children:"sync.Pool"})," \u7684\u5BF9\u8C61\u751F\u547D\u5468\u671F\u4E0D\u652F\u6301\u81EA\u5B9A\u4E49\u8FC7\u671F\u65F6\u95F4\uFF0C\u7A76\u5176\u539F\u56E0\uFF0C ",(0,i.jsx)(e.code,{children:"sync.Pool"})," \u5E76\u4E0D\u662F\u4E00\u4E2ACache\uFF1B ",(0,i.jsx)(e.code,{children:"sync.Pool"})," \u8BBE\u8BA1\u521D\u8877\u662F\u4E3A\u4E86\u7F13\u89E3GC\u538B\u529B\uFF0C ",(0,i.jsx)(e.code,{children:"sync.Pool"})," \u4E2D\u7684\u5BF9\u8C61\u4F1A\u5728GC\u5F00\u59CB\u524D\u5168\u90E8\u6E05\u9664\uFF1B\u5E76\u4E14 ",(0,i.jsx)(e.code,{children:"sync.Pool"})," \u4E0D\u652F\u6301\u5BF9\u8C61\u521B\u5EFA\u65B9\u6CD5\u53CA\u9500\u6BC1\u65B9\u6CD5\u3002"]}),"\n",(0,i.jsx)(e.h2,{id:"\u793A\u4F8B1\u57FA\u672C\u4F7F\u7528",children:"\u793A\u4F8B1\uFF0C\u57FA\u672C\u4F7F\u7528"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:'package main\n\nimport (\n    "github.com/gogf/gf/container/gpool"\n    "fmt"\n    "time"\n)\n\nfunc main () {\n    // \u521B\u5EFA\u4E00\u4E2A\u5BF9\u8C61\u6C60\uFF0C\u8FC7\u671F\u65F6\u95F4\u4E3A1\u79D2\n    p := gpool.New(time.Second, nil)\n\n    // \u4ECE\u6C60\u4E2D\u53D6\u4E00\u4E2A\u5BF9\u8C61\uFF0C\u8FD4\u56DEnil\u53CA\u9519\u8BEF\u4FE1\u606F\n    fmt.Println(p.Get())\n\n    // \u4E22\u4E00\u4E2A\u5BF9\u8C61\u5230\u6C60\u4E2D\n    p.Put(1)\n\n    // \u91CD\u65B0\u4ECE\u6C60\u4E2D\u53D6\u4E00\u4E2A\u5BF9\u8C61\uFF0C\u8FD4\u56DE1\n    fmt.Println(p.Get())\n\n    // \u7B49\u5F852\u79D2\u540E\u91CD\u8BD5\uFF0C\u53D1\u73B0\u5BF9\u8C61\u5DF2\u8FC7\u671F\uFF0C\u8FD4\u56DEnil\u53CA\u9519\u8BEF\u4FE1\u606F\n    time.Sleep(2*time.Second)\n    fmt.Println(p.Get())\n}\n\n'})}),"\n",(0,i.jsx)(e.h2,{id:"\u793A\u4F8B2\u521B\u5EFA\u53CA\u9500\u6BC1\u65B9\u6CD5",children:"\u793A\u4F8B2\uFF0C\u521B\u5EFA\u53CA\u9500\u6BC1\u65B9\u6CD5"}),"\n",(0,i.jsx)(e.p,{children:"\u6211\u4EEC\u53EF\u4EE5\u7ED9\u5B9A\u52A8\u6001\u521B\u5EFA\u53CA\u9500\u6BC1\u65B9\u6CD5\u3002"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:'package main\n\nimport (\n    "fmt"\n    "github.com/gogf/gf/container/gpool"\n    "github.com/gogf/gf/net/gtcp"\n    "github.com/gogf/gf/os/glog"\n    "time"\n)\n\nfunc main() {\n    // \u521B\u5EFA\u5BF9\u8C61\u590D\u7528\u6C60\uFF0C\u5BF9\u8C61\u8FC7\u671F\u65F6\u95F4\u4E3A3\u79D2\uFF0C\u5E76\u7ED9\u5B9A\u521B\u5EFA\u53CA\u9500\u6BC1\u65B9\u6CD5\n    p := gpool.New(3*time.Second, func() (interface{}, error) {\n        return gtcp.NewConn("www.baidu.com:80")\n    }, func(i interface{}) {\n        glog.Println("expired")\n        i.(*gtcp.Conn).Close()\n    })\n    conn, err := p.Get()\n    if err != nil {\n        panic(err)\n    }\n    result, err := conn.(*gtcp.Conn).SendRecv([]byte("HEAD / HTTP/1.1\\n\\n"), -1)\n    if err != nil {\n        panic(err)\n    }\n    fmt.Println(string(result))\n    // \u4E22\u56DE\u6C60\u4E2D\u4EE5\u4FBF\u91CD\u590D\u4F7F\u7528\n    p.Put(conn)\n    // \u7B49\u5F85\u4E00\u5B9A\u65F6\u95F4\u89C2\u5BDF\u8FC7\u671F\u65B9\u6CD5\u8C03\u7528\n    time.Sleep(4*time.Second)\n}\n\n'})}),"\n",(0,i.jsx)(e.p,{children:"\u6267\u884C\u540E\uFF0C\u7EC8\u7AEF\u8F93\u51FA\u7ED3\u679C\uFF1A"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-html",children:'HTTP/1.1 302 Found\nConnection: Keep-Alive\nContent-Length: 17931\nContent-Type: text/html\nDate: Wed, 29 May 2019 11:23:20 GMT\nEtag: "54d9749e-460b"\nServer: bfe/1.0.8.18\n\n2019-05-29 19:23:24.732 expired\n\n'})})]})}function p(n={}){let{wrapper:e}={...(0,r.a)(),...n.components};return e?(0,i.jsx)(e,{...n,children:(0,i.jsx)(g,{...n})}):g(n)}},250065:function(n,e,o){o.d(e,{Z:function(){return l},a:function(){return c}});var t=o(667294);let i={},r=t.createContext(i);function c(n){let e=t.useContext(r);return t.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function l(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(i):n.components||i:c(n.components),t.createElement(r.Provider,{value:e},n.children)}}}]);