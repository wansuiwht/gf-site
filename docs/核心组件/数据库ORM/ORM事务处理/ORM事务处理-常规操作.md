---
slug: '/core/gdb/transaction-basic
title: 'ORMäº‹åŠ¡å¤„ç†-å¸¸è§„æ“ä½œ'
sidebar_position: 0
hide_title: true
---

å¸¸è§„çš„äº‹åŠ¡æ“ä½œæ–¹æ³•ä¸º `Begin/Commit/Rollback`ï¼Œæ¯ä¸€ä¸ªæ–¹æ³•æŒ‡å®šç‰¹å®šçš„äº‹åŠ¡æ“ä½œã€‚å¼€å¯äº‹åŠ¡æ“ä½œå¯ä»¥é€šè¿‡æ‰§è¡Œ `db.Begin` æ–¹æ³•ï¼Œè¯¥æ–¹æ³•è¿”å›äº‹åŠ¡çš„æ“ä½œæ¥å£ï¼Œç±»å‹ä¸º `gdb.Tx`ï¼Œé€šè¿‡è¯¥å¯¹è±¡æ‰§è¡Œåç»­çš„æ•°æ®åº“æ“ä½œï¼Œå¹¶å¯é€šè¿‡ `tx.Commit` æäº¤ä¿®æ”¹ï¼Œæˆ–è€…é€šè¿‡ `tx.Rollback` å›æ»šä¿®æ”¹ã€‚

å¸¸è§é—®é¢˜æ³¨æ„ï¼šå¼€å¯äº‹åŠ¡æ“ä½œåï¼Œè¯·åŠ¡å¿…åœ¨ä¸éœ€è¦ä½¿ç”¨è¯¥äº‹åŠ¡å¯¹è±¡æ—¶ï¼Œé€šè¿‡ `Commit`/ `Rollback` æ“ä½œå…³é—­æ‰è¯¥äº‹åŠ¡ï¼Œå»ºè®®å……åˆ†åˆ©ç”¨å¥½ `defer` æ–¹æ³•ã€‚å¦‚æœäº‹åŠ¡ä½¿ç”¨åä¸å…³é—­ï¼Œåœ¨åº”ç”¨ä¾§ä¼šå¼•èµ· `goroutine` ä¸æ–­æ¿€å¢æ³„éœ²ï¼Œåœ¨æ•°æ®åº“ä¾§ä¼šå¼•èµ·äº‹åŠ¡çº¿ç¨‹æ•°é‡è¢«æ‰“æ»¡ï¼Œä»¥è‡³äºåç»­çš„äº‹åŠ¡è¯·æ±‚æ‰§è¡Œè¶…æ—¶ã€‚æ­¤å¤–ï¼Œå»ºè®®å°½å¯èƒ½ä½¿ç”¨åç»­ä»‹ç»çš„ `Transaction` é—­åŒ…æ–¹æ³•æ¥å®‰å…¨å®ç°äº‹åŠ¡æ“ä½œï¼š [ORMäº‹åŠ¡å¤„ç†-é—­åŒ…æ“ä½œ](ORMäº‹åŠ¡å¤„ç†-é—­åŒ…æ“ä½œ.md)

## ä¸€ã€å¼€å¯äº‹åŠ¡æ“ä½œ

```go
db := g.DB()

if tx, err := db.Begin(ctx); err == nil {
    fmt.Println("å¼€å¯äº‹åŠ¡æ“ä½œ")
}
```

äº‹åŠ¡æ“ä½œå¯¹è±¡å¯ä»¥æ‰§è¡Œæ‰€æœ‰ `db` å¯¹è±¡çš„æ–¹æ³•ï¼Œå…·ä½“è¯·å‚è€ƒ [APIæ–‡æ¡£](https://pkg.go.dev/github.com/gogf/gf/v2/database/gdb)ã€‚

## äºŒã€äº‹åŠ¡å›æ»šæ“ä½œ

```go
if tx, err := db.Begin(ctx); err == nil {
    r, err := tx.Save("user", g.Map{
        "id"   :  1,
        "name" : "john",
    })
    if err != nil {
        tx.Rollback()
    }
    fmt.Println(r)
}
```

## ä¸‰ã€äº‹åŠ¡æäº¤æ“ä½œ

```go
if tx, err := db.Begin(ctx); err == nil {
    r, err := tx.Save("user", g.Map{
        "id"   :  1,
        "name" : "john",
    })
    if err == nil {
       tx.Commit()
    }
    fmt.Println(r)
}
```

## å››ã€äº‹åŠ¡é“¾å¼æ“ä½œ

äº‹åŠ¡æ“ä½œå¯¹è±¡ä»ç„¶å¯ä»¥é€šè¿‡ `tx.Model` æ–¹æ³•è¿”å›ä¸€ä¸ªé“¾å¼æ“ä½œçš„å¯¹è±¡ï¼Œè¯¥å¯¹è±¡ä¸ `db.Model` æ–¹æ³•è¿”å›å€¼ç›¸åŒï¼Œåªä¸è¿‡æ•°æ®åº“æ“ä½œåœ¨äº‹åŠ¡ä¸Šæ‰§è¡Œï¼Œå¯æäº¤æˆ–å›æ»šã€‚

```go
if tx, err := db.Begin(); err == nil {
    r, err := tx.Model("user").Data(g.Map{"id":1, "name": "john_1"}).Save()
    if err == nil {
       tx.Commit()
    }
    fmt.Println(r)
}
```

å…¶ä»–é“¾å¼æ“ä½œè¯·å‚è€ƒ [ORMé“¾å¼æ“ä½œ(ğŸ”¥é‡ç‚¹ğŸ”¥)](../ORMé“¾å¼æ“ä½œ/ORMé“¾å¼æ“ä½œ.md) ç« èŠ‚ã€‚