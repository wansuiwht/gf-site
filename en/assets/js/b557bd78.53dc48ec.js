"use strict";(self.webpackChunkgf_site=self.webpackChunkgf_site||[]).push([["96905"],{171073:function(e,n,i){i.r(n),i.d(n,{metadata:()=>r,contentTitle:()=>s,default:()=>h,assets:()=>a,toc:()=>c,frontMatter:()=>d});var r=JSON.parse('{"id":"course/starbook/\u7B2C\u56DB\u7AE0-\u5355\u8BCD\u7BA1\u7406/4.4.\u7F16\u8F91\u5355\u8BCD","title":"4.4 Edit Word","description":"Utilize the REST API in the GoFrame framework to update word information, including the word\'s definition, example sentences, Chinese translation, and pronunciation. Emphasizes the uniqueness check and permission verification logic during edit operations, and demonstrates how to use the database to update data and handle errors through code examples.","source":"@site/i18n/en/docusaurus-plugin-content-docs/current/course/starbook/\u7B2C\u56DB\u7AE0-\u5355\u8BCD\u7BA1\u7406/4.4.\u7F16\u8F91\u5355\u8BCD.md","sourceDirName":"course/starbook/\u7B2C\u56DB\u7AE0-\u5355\u8BCD\u7BA1\u7406","slug":"/course/starbook/word-update","permalink":"/en/course/starbook/word-update","draft":false,"unlisted":false,"editUrl":"https://github.com/gogf/gf-site/blob/main/docs/course/starbook/\u7B2C\u56DB\u7AE0-\u5355\u8BCD\u7BA1\u7406/4.4.\u7F16\u8F91\u5355\u8BCD.md","tags":[],"version":"current","lastUpdatedBy":"John","lastUpdatedAt":1732458699000,"frontMatter":{"title":"4.4 Edit Word","hide_title":true,"slug":"/course/starbook/word-update","keywords":["GoFrame","Word Update","REST API","PUT Request","Word Definition","Uniqueness Check","Update Logic","Permission Verification","Database Operation","Error Handling"],"description":"Utilize the REST API in the GoFrame framework to update word information, including the word\'s definition, example sentences, Chinese translation, and pronunciation. Emphasizes the uniqueness check and permission verification logic during edit operations, and demonstrates how to use the database to update data and handle errors through code examples."},"sidebar":"courseStarBookSidebar","previous":{"title":"4.3 Add Word","permalink":"/en/course/starbook/word-create"},"next":{"title":"4.5 Word Pagination","permalink":"/en/course/starbook/word-list"}}'),t=i("785893"),o=i("250065");let d={title:"4.4 Edit Word",hide_title:!0,slug:"/course/starbook/word-update",keywords:["GoFrame","Word Update","REST API","PUT Request","Word Definition","Uniqueness Check","Update Logic","Permission Verification","Database Operation","Error Handling"],description:"Utilize the REST API in the GoFrame framework to update word information, including the word's definition, example sentences, Chinese translation, and pronunciation. Emphasizes the uniqueness check and permission verification logic during edit operations, and demonstrates how to use the database to update data and handle errors through code examples."},s=void 0,a={},c=[{value:"Add Api",id:"add-api",level:2},{value:"Implement Logic",id:"implement-logic",level:2},{value:"Controller Calls Logic",id:"controller-calls-logic",level:2},{value:"API Test",id:"api-test",level:2}];function l(e){let n={code:"code",em:"em",h2:"h2",hr:"hr",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,o.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(n.p,{children:["Editing a word uses the ",(0,t.jsx)(n.code,{children:"PUT"})," method, which represents updating a resource."]}),"\n",(0,t.jsx)(n.h2,{id:"add-api",children:"Add Api"}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.em,{children:"api/words/v1/words.go"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-go",children:'type UpdateReq struct {  \n    g.Meta             `path:"words/{id}" method:"put" sm:"Update" tags:"Word"`  \n    Id                 uint   `json:"id" v:"required"`  \n    Word               string `json:"word" v:"required|length:1,100" dc:"Word"`  \n    Definition         string `json:"definition" v:"required|length:1,300" dc:"Word Definition"`  \n    ExampleSentence    string `json:"example_sentence" v:"required|length:1,300" dc:"Example Sentence"`  \n    ChineseTranslation string `json:"chinese_translation" v:"required|length:1,300" dc:"Chinese Translation"`  \n    Pronunciation      string `json:"pronunciation" v:"required|length:1,100" dc:"Pronunciation"`  \n    ProficiencyLevel   uint   `json:"proficiency_level" v:"required|between:1,5" dc:"Proficiency Level, 1 minimum, 5 maximum"`  \n}  \n  \ntype UpdateRes struct {  \n}\n'})}),"\n",(0,t.jsx)(n.h2,{id:"implement-logic",children:"Implement Logic"}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsxs)(n.p,{children:["During editing, we also need to check if the ",(0,t.jsx)(n.code,{children:"word"})," is unique. The existing ",(0,t.jsx)(n.code,{children:"checkWord"})," function is not sufficient, as it checks including itself, so we need to improve it:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Add an ",(0,t.jsx)(n.code,{children:"id"})," field; when the ",(0,t.jsx)(n.code,{children:"id"})," is not ",(0,t.jsx)(n.code,{children:"0"}),", use the combination of ",(0,t.jsx)(n.code,{children:"id"})," and ",(0,t.jsx)(n.code,{children:"word"})," for judgment;"]}),"\n",(0,t.jsxs)(n.li,{children:["When ",(0,t.jsx)(n.code,{children:"id"})," is ",(0,t.jsx)(n.code,{children:"0"}),", it represents a new addition, and only ",(0,t.jsx)(n.code,{children:"word"})," is used for judgment."]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.em,{children:"internal/logic/words/words.go"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-go",children:'package words\n\n...\n\nfunc Create(ctx context.Context, in *model.WordInput) error {  \n    if err := checkWord(ctx, 0, in); err != nil {  \n       return err  \n    }\n    ...\n}\n\n// checkWord does not check itself during an update  \nfunc checkWord(ctx context.Context, id uint, in *model.WordInput) error {  \n    db := dao.Words.Ctx(ctx).Where("uid", in.Uid).Where("word", in.Word)  \n    if id > 0 {  \n       db = db.WhereNot("id", id)  \n    }  \n    count, err := db.Count()  \n    if err != nil {  \n       return err  \n    }  \n    if count > 0 {  \n       return gerror.New("Word already exists")  \n    }  \n    return nil  \n}\n'})}),"\n",(0,t.jsx)(n.p,{children:"Add the update logic:"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.em,{children:"internal/logic/words/words.go"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-go",children:'package words  \n\n...\n\nfunc Update(ctx context.Context, id uint, in *model.WordInput) error {  \n    if err := checkWord(ctx, id, in); err != nil {  \n       return err  \n    }  \n      \n    db := dao.Words.Ctx(ctx).Where("uid", in.Uid).Data(do.Words{  \n       Word:               in.Word,  \n       Definition:         in.Definition,  \n       ExampleSentence:    in.ExampleSentence,  \n       ChineseTranslation: in.ChineseTranslation,  \n       Pronunciation:      in.Pronunciation,  \n       ProficiencyLevel:   in.ProficiencyLevel,  \n    }).Where("id", id)  \n    if in.Uid > 0 {  \n       db = db.Where("uid", in.Uid)  \n    }  \n  \n    _, err := db.Update()  \n    if err != nil {  \n       return err  \n    }  \n    return nil  \n}\n\n...\n'})}),"\n",(0,t.jsxs)(n.p,{children:["When ",(0,t.jsx)(n.code,{children:"Uid"})," is greater than zero, the ",(0,t.jsx)(n.code,{children:"Uid"})," condition must be added to the ",(0,t.jsx)(n.code,{children:"ORM"})," chain to prevent unauthorized access, the same applies to subsequent query and delete actions."]}),"\n",(0,t.jsx)(n.h2,{id:"controller-calls-logic",children:"Controller Calls Logic"}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.em,{children:"internal/controller/words/words_v1_update.go"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-go",children:'package words  \n  \nimport (  \n    "context"  \n  \n    "star/internal/logic/users"\n    "star/internal/logic/words"\n    "star/internal/model"  \n    "star/api/words/v1"\n)  \n  \nfunc (c *ControllerV1) Update(ctx context.Context, req *v1.UpdateReq) (res *v1.UpdateRes, err error) {  \n    uid, err := users.GetUid(ctx)  \n    if err != nil {  \n       return nil, err  \n    }  \n    err = words.Update(ctx, req.Id, &model.WordInput{  \n       Uid:                uid,  \n       Word:               req.Word,  \n       Definition:         req.Definition,  \n       ExampleSentence:    req.ExampleSentence,  \n       ChineseTranslation: req.ChineseTranslation,  \n       Pronunciation:      req.Pronunciation,  \n       ProficiencyLevel:   model.ProficiencyLevel(req.ProficiencyLevel),  \n    })  \n    return nil, err  \n}\n'})}),"\n",(0,t.jsx)(n.h2,{id:"api-test",children:"API Test"}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'$ curl -X PUT http://127.0.0.1:8000/v1/words/1 \\\n     -H "Authorization: eyJhbGci...5U" \\\n     -H "Content-Type: application/json" \\\n     -d \'{\n           "word": "example_update",\n           "definition": "A representative form or pattern.",\n           "example_sentence": "This is an example sentence.",\n           "chinese_translation": "\u4F8B\u5B50",\n           "pronunciation": "\u026A\u0261\u02C8z\u0251\u02D0mp(\u0259)l",\n           "proficiency_level": 3\n         }\'\n\n{\n    "code": 0,\n    "message": "",\n    "data": null\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:"Execute the command to check if the data has been updated correctly:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"$ SELECT * FROM words;\n"})}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"id"}),(0,t.jsx)(n.th,{children:"uid"}),(0,t.jsx)(n.th,{children:"word"}),(0,t.jsx)(n.th,{children:"definition"}),(0,t.jsx)(n.th,{children:"example_sentence"}),(0,t.jsx)(n.th,{children:"chinese_translation"}),(0,t.jsx)(n.th,{children:"pronunciation"}),(0,t.jsx)(n.th,{children:"proficiency_level"}),(0,t.jsx)(n.th,{children:"created_at"}),(0,t.jsx)(n.th,{children:"updated_at"})]})}),(0,t.jsx)(n.tbody,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"1"}),(0,t.jsx)(n.td,{children:"1"}),(0,t.jsx)(n.td,{children:"example_update"}),(0,t.jsx)(n.td,{children:"A representative form or pattern."}),(0,t.jsx)(n.td,{children:"This is an example sentence."}),(0,t.jsx)(n.td,{children:"\u4F8B\u5B50"}),(0,t.jsx)(n.td,{children:"\u026A\u0261\u02C8z\u0251\u02D0mp(\u0259)l"}),(0,t.jsx)(n.td,{children:"3"}),(0,t.jsx)(n.td,{children:"2024/11/12 15:38:50"}),(0,t.jsx)(n.td,{children:"2024/11/12 15:38:50"})]})})]})]})}function h(e={}){let{wrapper:n}={...(0,o.a)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}},250065:function(e,n,i){i.d(n,{Z:function(){return s},a:function(){return d}});var r=i(667294);let t={},o=r.createContext(t);function d(e){let n=r.useContext(o);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:d(e.components),r.createElement(o.Provider,{value:n},e.children)}}}]);