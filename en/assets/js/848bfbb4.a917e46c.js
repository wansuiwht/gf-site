"use strict";(self.webpackChunkgfdoc=self.webpackChunkgfdoc||[]).push([[33539],{332819:(n,e,c)=>{c.r(e),c.d(e,{assets:()=>a,contentTitle:()=>i,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>l});var r=c(474848),t=c(28453);const o={title:"\u7f13\u5b58\u7ba1\u7406-\u5185\u5b58\u7f13\u5b58",sidebar_position:0,hide_title:!0},i=void 0,s={id:"\u6838\u5fc3\u7ec4\u4ef6-\u91cd\u70b9/\u7f13\u5b58\u7ba1\u7406/\u7f13\u5b58\u7ba1\u7406-\u5185\u5b58\u7f13\u5b58",title:"\u7f13\u5b58\u7ba1\u7406-\u5185\u5b58\u7f13\u5b58",description:"gcache \u6a21\u5757\u9ed8\u8ba4\u63d0\u4f9b\u7684\u662f\u4e00\u4e2a\u9ad8\u901f\u7684\u5185\u5b58\u7f13\u5b58\uff0c\u64cd\u4f5c\u6548\u7387\u975e\u5e38\u9ad8\u6548\uff0c CPU \u6027\u80fd\u635f\u8017\u5728 ns \u7eb3\u79d2\u7ea7\u522b\u3002",source:"@site/versioned_docs/version-1.16.x/\u6838\u5fc3\u7ec4\u4ef6-\u91cd\u70b9/\u7f13\u5b58\u7ba1\u7406/\u7f13\u5b58\u7ba1\u7406-\u5185\u5b58\u7f13\u5b58.md",sourceDirName:"\u6838\u5fc3\u7ec4\u4ef6-\u91cd\u70b9/\u7f13\u5b58\u7ba1\u7406",slug:"/\u6838\u5fc3\u7ec4\u4ef6-\u91cd\u70b9/\u7f13\u5b58\u7ba1\u7406/\u7f13\u5b58\u7ba1\u7406-\u5185\u5b58\u7f13\u5b58",permalink:"/gf-site/en/docs/1.16.x/\u6838\u5fc3\u7ec4\u4ef6-\u91cd\u70b9/\u7f13\u5b58\u7ba1\u7406/\u7f13\u5b58\u7ba1\u7406-\u5185\u5b58\u7f13\u5b58",draft:!1,unlisted:!1,editUrl:"https://github.com/gogf/gf-site/blob/main/versioned_docs/version-1.16.x/\u6838\u5fc3\u7ec4\u4ef6-\u91cd\u70b9/\u7f13\u5b58\u7ba1\u7406/\u7f13\u5b58\u7ba1\u7406-\u5185\u5b58\u7f13\u5b58.md",tags:[],version:"1.16.x",lastUpdatedBy:"John",lastUpdatedAt:173036553e4,sidebarPosition:0,frontMatter:{title:"\u7f13\u5b58\u7ba1\u7406-\u5185\u5b58\u7f13\u5b58",sidebar_position:0,hide_title:!0},sidebar:"tutorialSidebar",previous:{title:"\u7f13\u5b58\u7ba1\u7406",permalink:"/gf-site/en/docs/1.16.x/\u6838\u5fc3\u7ec4\u4ef6-\u91cd\u70b9/\u7f13\u5b58\u7ba1\u7406/"},next:{title:"\u7f13\u5b58\u7ba1\u7406-\u7f13\u5b58\u9002\u914d",permalink:"/gf-site/en/docs/1.16.x/\u6838\u5fc3\u7ec4\u4ef6-\u91cd\u70b9/\u7f13\u5b58\u7ba1\u7406/\u7f13\u5b58\u7ba1\u7406-\u7f13\u5b58\u9002\u914d"}},a={},l=[{value:"\u793a\u4f8b1\uff0c\u57fa\u672c\u4f7f\u7528",id:"\u793a\u4f8b1\u57fa\u672c\u4f7f\u7528",level:2},{value:"\u793a\u4f8b2\uff0c\u7f13\u5b58\u63a7\u5236",id:"\u793a\u4f8b2\u7f13\u5b58\u63a7\u5236",level:2},{value:"\u793a\u4f8b3\uff0c <code>GetOrSetFunc*</code>",id:"\u793a\u4f8b3-getorsetfunc",level:2},{value:"\u793a\u4f8b4\uff0c <code>LRU</code> \u7f13\u5b58\u6dd8\u6c70\u63a7\u5236",id:"\u793a\u4f8b4-lru-\u7f13\u5b58\u6dd8\u6c70\u63a7\u5236",level:2},{value:"\u6027\u80fd\u6d4b\u8bd5",id:"\u6027\u80fd\u6d4b\u8bd5",level:2},{value:"\u6d4b\u8bd5\u73af\u5883",id:"\u6d4b\u8bd5\u73af\u5883",level:3},{value:"\u6d4b\u8bd5\u7ed3\u679c",id:"\u6d4b\u8bd5\u7ed3\u679c",level:3}];function d(n){const e={code:"code",h2:"h2",h3:"h3",p:"p",pre:"pre",strong:"strong",...(0,t.R)(),...n.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.code,{children:"gcache"})," \u6a21\u5757\u9ed8\u8ba4\u63d0\u4f9b\u7684\u662f\u4e00\u4e2a\u9ad8\u901f\u7684\u5185\u5b58\u7f13\u5b58\uff0c\u64cd\u4f5c\u6548\u7387\u975e\u5e38\u9ad8\u6548\uff0c ",(0,r.jsx)(e.code,{children:"CPU"})," \u6027\u80fd\u635f\u8017\u5728 ",(0,r.jsx)(e.code,{children:"ns"})," \u7eb3\u79d2\u7ea7\u522b\u3002"]}),"\n",(0,r.jsx)(e.h2,{id:"\u793a\u4f8b1\u57fa\u672c\u4f7f\u7528",children:"\u793a\u4f8b1\uff0c\u57fa\u672c\u4f7f\u7528"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-go",children:'package main\n\nimport (\n    "fmt"\n    "github.com/gogf/gf/os/gcache"\n)\n\nfunc main() {\n    // \u521b\u5efa\u4e00\u4e2a\u7f13\u5b58\u5bf9\u8c61\uff0c\n    // \u5f53\u7136\u4e5f\u53ef\u4ee5\u4fbf\u6377\u5730\u76f4\u63a5\u4f7f\u7528gcache\u5305\u65b9\u6cd5\n    c := gcache.New()\n\n    // \u8bbe\u7f6e\u7f13\u5b58\uff0c\u4e0d\u8fc7\u671f\n    c.Set("k1", "v1", 0)\n\n    // \u83b7\u53d6\u7f13\u5b58\n    v, _ := c.Get("k1")\n    fmt.Println(v)\n\n    // \u83b7\u53d6\u7f13\u5b58\u5927\u5c0f\n    n, _ := c.Size()\n    fmt.Println(n)\n\n    // \u7f13\u5b58\u4e2d\u662f\u5426\u5b58\u5728\u6307\u5b9a\u952e\u540d\n    b, _ := c.Contains("k1")\n    fmt.Println(b)\n\n    // \u5220\u9664\u5e76\u8fd4\u56de\u88ab\u5220\u9664\u7684\u952e\u503c\n    fmt.Println(c.Remove("k1"))\n\n    // \u5173\u95ed\u7f13\u5b58\u5bf9\u8c61\uff0c\u8ba9GC\u56de\u6536\u8d44\u6e90\n    c.Close()\n}\n\n'})}),"\n",(0,r.jsx)(e.p,{children:"\u6267\u884c\u540e\uff0c\u8f93\u51fa\u7ed3\u679c\u4e3a\uff1a"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-html",children:"v1\n1\ntrue\nv1\n\n"})}),"\n",(0,r.jsx)(e.h2,{id:"\u793a\u4f8b2\u7f13\u5b58\u63a7\u5236",children:"\u793a\u4f8b2\uff0c\u7f13\u5b58\u63a7\u5236"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-go",children:'package main\n\nimport (\n    "fmt"\n    "github.com/gogf/gf/os/gcache"\n    "time"\n)\n\nfunc main() {\n    // \u5f53\u952e\u540d\u4e0d\u5b58\u5728\u65f6\u5199\u5165\uff0c\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f41000\u6beb\u79d2\n    gcache.SetIfNotExist("k1", "v1", 1000*time.Millisecond)\n\n    // \u6253\u5370\u5f53\u524d\u7684\u952e\u540d\u5217\u8868\n    keys, _ := gcache.Keys()\n    fmt.Println(keys)\n\n    // \u6253\u5370\u5f53\u524d\u7684\u952e\u503c\u5217\u8868\n    values, _ := gcache.Values()\n    fmt.Println(values)\n\n    // \u83b7\u53d6\u6307\u5b9a\u952e\u503c\uff0c\u5982\u679c\u4e0d\u5b58\u5728\u65f6\u5199\u5165\uff0c\u5e76\u8fd4\u56de\u952e\u503c\n    v, _ := gcache.GetOrSet("k2", "v2", 0)\n    fmt.Println(v)\n\n    // \u6253\u5370\u5f53\u524d\u7684\u952e\u503c\u5bf9\n    data1, _ := gcache.Data()\n    fmt.Println(data1)\n\n    // \u7b49\u5f851\u79d2\uff0c\u4ee5\u4fbfk1:v1\u81ea\u52a8\u8fc7\u671f\n    time.Sleep(time.Second)\n\n    // \u518d\u6b21\u6253\u5370\u5f53\u524d\u7684\u952e\u503c\u5bf9\uff0c\u53d1\u73b0k1:v1\u5df2\u7ecf\u8fc7\u671f\uff0c\u53ea\u5269\u4e0bk2:v2\n    data2, _ := gcache.Data()\n    fmt.Println(data2)\n}\n\n'})}),"\n",(0,r.jsx)(e.p,{children:"\u6267\u884c\u540e\uff0c\u8f93\u51fa\u7ed3\u679c\u4e3a\uff1a"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-html",children:"[k1]\n[v1]\nv2\nmap[k1:v1 k2:v2]\nmap[k2:v2]\n\n"})}),"\n",(0,r.jsxs)(e.h2,{id:"\u793a\u4f8b3-getorsetfunc",children:["\u793a\u4f8b3\uff0c ",(0,r.jsx)(e.code,{children:"GetOrSetFunc*"})]}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.code,{children:"GetOrSetFunc"})," \u83b7\u53d6\u4e00\u4e2a\u7f13\u5b58\u503c\uff0c\u5f53\u7f13\u5b58\u4e0d\u5b58\u5728\u65f6\u6267\u884c\u6307\u5b9a\u7684 ",(0,r.jsx)(e.code,{children:"f func() (interface{}, error)"}),"\uff0c\u7f13\u5b58\u8be5 ",(0,r.jsx)(e.code,{children:"f"})," \u65b9\u6cd5\u7684\u7ed3\u679c\u503c\uff0c\u5e76\u8fd4\u56de\u8be5\u7ed3\u679c\u3002"]}),"\n",(0,r.jsxs)(e.p,{children:["\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c ",(0,r.jsx)(e.code,{children:"GetOrSetFunc"})," \u7684\u7f13\u5b58\u65b9\u6cd5\u53c2\u6570 ",(0,r.jsx)(e.code,{children:"f"})," \u662f\u5728\u7f13\u5b58\u7684 ",(0,r.jsx)(e.strong,{children:"\u9501\u673a\u5236\u5916\u6267\u884c"}),"\uff0c\u56e0\u6b64\u5728 ",(0,r.jsx)(e.code,{children:"f"})," \u5185\u90e8\u4e5f\u53ef\u4ee5\u5d4c\u5957\u8c03\u7528 ",(0,r.jsx)(e.code,{children:"GetOrSetFunc"}),"\u3002\u4f46\u5982\u679c ",(0,r.jsx)(e.code,{children:"f"})," \u7684\u6267\u884c\u6bd4\u8f83\u8017\u65f6\uff0c\u9ad8\u5e76\u53d1\u7684\u65f6\u5019\u5bb9\u6613\u51fa\u73b0 ",(0,r.jsx)(e.code,{children:"f"})," \u88ab\u591a\u6b21\u6267\u884c\u7684\u60c5\u51b5(\u7f13\u5b58\u8bbe\u7f6e\u53ea\u6709\u7b2c\u4e00\u4e2a\u6267\u884c\u7684 ",(0,r.jsx)(e.code,{children:"f"})," \u8fd4\u56de\u7ed3\u679c\u80fd\u591f\u8bbe\u7f6e\u6210\u529f\uff0c\u5176\u4f59\u7684\u88ab\u629b\u5f03\u6389)\u3002"]}),"\n",(0,r.jsxs)(e.p,{children:["\u800c ",(0,r.jsx)(e.code,{children:"GetOrSetFuncLock"})," \u7684\u7f13\u5b58\u65b9\u6cd5 ",(0,r.jsx)(e.code,{children:"f"})," \u662f\u5728\u7f13\u5b58\u7684 ",(0,r.jsx)(e.strong,{children:"\u9501\u673a\u5236\u5185\u6267\u884c"}),"\uff0c\u56e0\u6b64\u53ef\u4ee5\u4fdd\u8bc1\u5f53\u7f13\u5b58\u9879\u4e0d\u5b58\u5728\u65f6\u53ea\u4f1a\u6267\u884c\u4e00\u6b21 ",(0,r.jsx)(e.code,{children:"f"}),"\uff0c\u4f46\u662f\u7f13\u5b58\u5199\u9501\u7684\u65f6\u95f4\u968f\u7740 ",(0,r.jsx)(e.code,{children:"f"})," \u65b9\u6cd5\u7684\u6267\u884c\u65f6\u95f4\u800c\u5b9a\u3002"]}),"\n",(0,r.jsxs)(e.p,{children:["\u6211\u4eec\u6765\u770b\u4e00\u4e2a\u5728 ",(0,r.jsx)(e.code,{children:"gf-home"})," \u9879\u76ee\u4e2d\u4f7f\u7528 ",(0,r.jsx)(e.code,{children:"GetOrSetFunc"})," \u7684\u793a\u4f8b\uff0c\u8be5\u793a\u4f8b\u904d\u5386\u68c0\u7d22 ",(0,r.jsx)(e.code,{children:"markdown"})," \u6587\u4ef6\u8fdb\u884c\u5b57\u7b26\u4e32\u68c0\u7d22\uff0c\u5e76\u6839\u636e\u6307\u5b9a\u7684\u641c\u7d22 ",(0,r.jsx)(e.code,{children:"key"})," \u7f13\u5b58\u8be5\u7ed3\u679c\u503c\uff0c\u56e0\u6b64\u591a\u6b21\u641c\u7d22\u8be5 ",(0,r.jsx)(e.code,{children:"key"})," \u65f6\uff0c\u7b2c\u4e00\u6b21\u4f1a\u6267\u884c\u76ee\u5f55\u904d\u5386\u641c\u7d22\uff0c\u540e\u7eed\u5c06\u76f4\u63a5\u4f7f\u7528\u7f13\u5b58\u7ed3\u679c\u3002"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-go",children:'// \u6839\u636e\u5173\u952e\u5b57\u8fdb\u884cmarkdown\u6587\u6863\u641c\u7d22\uff0c\u8fd4\u56de\u6587\u6863path\u5217\u8868\nfunc SearchMdByKey(key string) ([]string, error) {\n    v, err := gcache.GetOrSetFunc("doc_search_result_"+key, func() (interface{}, error) {\n        // \u5f53\u8be5key\u7684\u68c0\u7d22\u7f13\u5b58\u4e0d\u5b58\u5728\u65f6\uff0c\u6267\u884c\u68c0\u7d22\n        array := garray.NewStrArray()\n        docPath := g.Cfg().GetString("doc.path")\n        paths, err := gcache.GetOrSetFunc("doc_files_recursive", func() (interface{}, error) {\n            // \u5f53\u76ee\u5f55\u5217\u8868\u4e0d\u5b58\u5728\u65f6\uff0c\u6267\u884c\u68c0\u7d22\n            return gfile.ScanDir(docPath, "*.md", true)\n        }, 0)\n        if err != nil {\n            return nil, err\n        }\n        // \u904d\u5386markdown\u6587\u4ef6\u5217\u8868\uff0c\u6267\u884c\u5b57\u7b26\u4e32\u641c\u7d22\n        for _, path := range gconv.Strings(paths) {\n            content := gfile.GetContents(path)\n            if len(content) > 0 {\n                if strings.Index(content, key) != -1 {\n                    index := gstr.Replace(path, ".md", "")\n                    index = gstr.Replace(index, docPath, "")\n                    array.Append(index)\n                }\n            }\n        }\n        return array.Slice(), nil\n    }, 0)\n    if err != nil {\n        return nil, err\n    }\n    return gconv.Strings(v), nil\n}\n\n'})}),"\n",(0,r.jsxs)(e.h2,{id:"\u793a\u4f8b4-lru-\u7f13\u5b58\u6dd8\u6c70\u63a7\u5236",children:["\u793a\u4f8b4\uff0c ",(0,r.jsx)(e.code,{children:"LRU"})," \u7f13\u5b58\u6dd8\u6c70\u63a7\u5236"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-go",children:'package main\n\nimport (\n    "github.com/gogf/gf/os/gcache"\n    "time"\n    "fmt"\n)\n\nfunc main() {\n    // \u8bbe\u7f6eLRU\u6dd8\u6c70\u6570\u91cf\n    c := gcache.New(2)\n\n    // \u6dfb\u52a010\u4e2a\u5143\u7d20\uff0c\u4e0d\u8fc7\u671f\n    for i := 0; i < 10; i++ {\n        c.Set(i, i, 0)\n    }\n    n, _ := c.Size()\n    fmt.Println(n)\n    keys, _ := c.Keys()\n    fmt.Println(keys)\n\n    // \u8bfb\u53d6\u952e\u540d1\uff0c\u4fdd\u8bc1\u8be5\u952e\u540d\u662f\u4f18\u5148\u4fdd\u7559\n    v, _ := c.Get(1)\n    fmt.Println(v)\n\n    // \u7b49\u5f85\u4e00\u5b9a\u65f6\u95f4\u540e(\u9ed8\u8ba41\u79d2\u68c0\u67e5\u4e00\u6b21)\uff0c\n    // \u5143\u7d20\u4f1a\u88ab\u6309\u7167\u4ece\u65e7\u5230\u65b0\u7684\u987a\u5e8f\u8fdb\u884c\u6dd8\u6c70\n    time.Sleep(2*time.Second)\n    n, _ = c.Size()\n    fmt.Println(n)\n    keys, _ = c.Keys()\n    fmt.Println(keys)\n}\n\n'})}),"\n",(0,r.jsx)(e.p,{children:"\u6267\u884c\u540e\uff0c\u8f93\u51fa\u7ed3\u679c\u4e3a\uff1a"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-html",children:"10\n[2 4 5 7 8 9 0 1 3 6]\n1\n2\n[1 9]\n\n"})}),"\n",(0,r.jsx)(e.h2,{id:"\u6027\u80fd\u6d4b\u8bd5",children:"\u6027\u80fd\u6d4b\u8bd5"}),"\n",(0,r.jsx)(e.h3,{id:"\u6d4b\u8bd5\u73af\u5883",children:"\u6d4b\u8bd5\u73af\u5883"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-shell",children:"CPU: Intel(R) Core(TM) i5-4460  CPU @ 3.20GHz\nMEM: 8GB\nSYS: Ubuntu 16.04 amd64\n\n"})}),"\n",(0,r.jsx)(e.h3,{id:"\u6d4b\u8bd5\u7ed3\u679c",children:"\u6d4b\u8bd5\u7ed3\u679c"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-html",children:'john@john-B85M:~/Workspace/Go/GOPATH/src/github.com/gogf/gf/os/gcache$ go test *.go -bench=".*" -benchmem\ngoos: linux\ngoarch: amd64\nBenchmark_CacheSet-4                       2000000        897 ns/op      249 B/op        4 allocs/op\nBenchmark_CacheGet-4                       5000000        202 ns/op       49 B/op        1 allocs/op\nBenchmark_CacheRemove-4                   50000000       35.7 ns/op        0 B/op        0 allocs/op\nBenchmark_CacheLruSet-4                    2000000        880 ns/op      399 B/op        4 allocs/op\nBenchmark_CacheLruGet-4                    3000000        212 ns/op       33 B/op        1 allocs/op\nBenchmark_CacheLruRemove-4                50000000       35.9 ns/op        0 B/op        0 allocs/op\nBenchmark_InterfaceMapWithLockSet-4        3000000        477 ns/op       73 B/op        2 allocs/op\nBenchmark_InterfaceMapWithLockGet-4       10000000        149 ns/op        0 B/op        0 allocs/op\nBenchmark_InterfaceMapWithLockRemove-4    50000000       39.8 ns/op        0 B/op        0 allocs/op\nBenchmark_IntMapWithLockWithLockSet-4      5000000        304 ns/op       53 B/op        0 allocs/op\nBenchmark_IntMapWithLockGet-4             20000000        164 ns/op        0 B/op        0 allocs/op\nBenchmark_IntMapWithLockRemove-4          50000000       33.1 ns/op        0 B/op        0 allocs/op\nPASS\nok   command-line-arguments 47.503s\n\n'})})]})}function h(n={}){const{wrapper:e}={...(0,t.R)(),...n.components};return e?(0,r.jsx)(e,{...n,children:(0,r.jsx)(d,{...n})}):d(n)}},28453:(n,e,c)=>{c.d(e,{R:()=>i,x:()=>s});var r=c(296540);const t={},o=r.createContext(t);function i(n){const e=r.useContext(o);return r.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function s(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(t):n.components||t:i(n.components),r.createElement(o.Provider,{value:e},n.children)}}}]);